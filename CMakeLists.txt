cmake_minimum_required(VERSION 3.25)
project(cnetflow C)
SET (CMAKE_C_COMPILER             "/usr/bin/gcc")
#SET (CMAKE_C_COMPILER             "/usr/bin/clang")
SET (CMAKE_C_FLAGS_DEBUG          "-g -Wall -Wextra -pedantic ")
SET (CMAKE_C_FLAGS_MINSIZEREL     "-Os -DNDEBUG -Wall -Wextra -pedantic")
SET (CMAKE_C_FLAGS_RELEASE        "-O4 -DNDEBUG -Wall -Wextra -pedantic")
#SET (CMAKE_C_FLAGS_RELWITHDEBINFO "-O2 -g -Wall -Wextra -pedantic")
set(CMAKE_INTERPROCEDURAL_OPTIMIZATION TRUE)
set(CMAKE_INCLUDE_PATH "/usr/include/postgresql/15/server/libpq/")
option(BUILD_SHARED_LIBS "Build shared libraries" ON)
set(CMAKE_C_STANDARD 99)
add_library(dyn_array       SHARED src/dyn_array.c)
add_library(db_psql       SHARED src/db_psql.c)
add_library(netflow       SHARED src/netflow.c)
add_library(netflow_v5    SHARED src/netflow_v5.c)
add_library(netflow_v9    SHARED src/netflow_v9.c)
add_library(netflow_ipfix SHARED src/netflow_ipfix.c)
add_library(collector     SHARED src/collector.c)
add_library(hashmap       SHARED src/hashmap.c)
add_library(arena         SHARED src/arena.c)

add_executable(cnetflow src/main.c)
target_link_libraries(collector uv arena hashmap netflow netflow_ipfix netflow_v5 netflow_v9 db_psql pq)
target_link_libraries(cnetflow uv netflow netflow_ipfix netflow_v5 netflow_v9 arena hashmap collector db_psql pq)